<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organograma Fabreck Pneus (Otimizado)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <style>
        /* Estilos gerais e de componentes */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .employee-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
            transition: all 0.2s ease-in-out;
        }

        .employee-card.terminated {
            color: #dc2626;
            /* Vermelho */
            font-weight: 600;
            background-color: #fee2e2;
        }

        .sub-nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .sub-nav-tabs button {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            color: #64748b;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease-in-out;
            background-color: transparent;
            border-radius: 0.5rem 0.5rem 0 0;
            margin: 0 0.25rem;
        }

        .sub-nav-tabs button.active {
            color: #1e3a8a;
            /* Azul mais escuro */
            border-bottom-color: #1e3a8a;
            background-color: #ffffff;
        }

        .sub-nav-tabs button:hover:not(.active) {
            color: #2563eb;
            background-color: #eff6ff;
        }

        .sector-card {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            border-top: 4px solid #2563eb;
            /* Destaque azul */
            border-radius: 0.75rem;
            padding: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }

        .sector-card.leader {
            border-top-color: #dc2626;
            /* Destaque vermelho para líderes */
        }

        .sector-card h4 {
            font-weight: 700;
            color: #111827;
            text-align: center;
            margin-bottom: 0.75rem;
            font-size: 1.125rem;
        }

        /* --- Estilos de Impressão --- */
        @media print {
            body {
                background: #fff !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            nav,
            #modal-backdrop,
            #confirm-modal-backdrop,
            #message-container,
            .no-print {
                display: none !important;
            }

            .print-header {
                display: block !important;
                text-align: center;
                margin-bottom: 2rem;
            }

            .print-logo {
                max-width: 200px;
                margin: 0 auto 1rem;
            }

            #print-footer {
                display: block !important;
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                text-align: center;
                padding: 10px 0;
                font-size: 9pt;
                color: #666;
                border-top: 1px solid #ccc;
            }

            main {
                padding: 1.5cm !important;
                margin: 0 !important;
                width: 100% !important;
                max-width: 100% !important;
            }

            .printable-area {
                box-shadow: none !important;
                padding: 0 !important;
                border: none !important;
            }

            .print-title {
                display: block !important;
                text-align: center;
                font-size: 22pt;
                font-weight: bold;
                margin-bottom: 1.5rem;
            }

            .org-chart-container,
            .org-chart-columns {
                display: block !important;
                flex-direction: column !important;
            }

            .org-chart-column {
                width: 100% !important;
                page-break-inside: avoid;
                margin-bottom: 1.5cm;
            }

            .shift-header {
                background-color: #1e3a8a !important;
                color: white !important;
                padding: 0.5rem;
                border-radius: 0.5rem;
                text-align: center;
            }

            .shift-header h3 {
                font-size: 16pt;
                font-weight: bold;
            }

            .shift-header p {
                font-size: 10pt;
            }

            .sector-card {
                page-break-inside: avoid;
                border: 1px solid #ccc !important;
                margin-top: 1rem;
                box-shadow: none !important;
            }

            .sector-card h4 {
                font-size: 12pt;
                background-color: #f3f4f6 !important;
                padding: 0.25rem;
                border-radius: 0.25rem;
            }

            .employee-card {
                padding: 0.25rem;
                border: 1px solid #eee;
                background-color: #fff !important;
                font-size: 10pt;
                box-shadow: none !important;
            }

            .employee-card.terminated {
                color: #dc2626 !important;
                background-color: #fee2e2 !important;
            }
        }
    </style>
</head>

<body class="min-h-screen bg-gray-100 flex flex-col lg:flex-row">

    <!-- Barra de Navegação Lateral -->
    <nav class="bg-blue-900 text-white w-full lg:w-64 p-4 lg:p-6 shadow-lg flex flex-col flex-shrink-0 no-print">
        <div id="logo-container" class="mb-6"></div>
        <div id="navigation-container">
            <!-- Conteúdo da Navegação será inserido aqui pelo JavaScript -->
        </div>
        <div class="mt-auto pt-4 border-t border-blue-700">
            <h2 class="text-xl font-semibold mb-4 border-b border-blue-700 pb-2">Área Administrativa</h2>
            <div id="admin-login-section" class="hidden">
                <input type="password" id="admin-password-input" placeholder="Senha Admin"
                    class="w-full p-2 rounded-md bg-blue-800 text-white placeholder-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-400 mb-2">
                <button id="admin-login-btn"
                    class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md transition duration-200 ease-in-out">Login
                    Admin</button>
            </div>
            <div id="admin-logout-section" class="">
                <p class="text-sm mb-2">Logado como Admin.</p>
                <button id="admin-logout-btn"
                    class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md mb-4">Sair
                    Admin</button>
                <button id="download-html-btn"
                    class="w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-md transition duration-200 ease-in-out">Salvar
                    e Baixar Arquivo</button>
            </div>
        </div>
    </nav>

    <!-- Conteúdo Principal -->
    <main id="main-content-area" class="flex-grow p-4 sm:p-8 lg:p-10 flex items-center justify-center">
        <!-- Conteúdo Principal será inserido aqui pelo JavaScript -->
    </main>

    <!-- Contentores para Mensagens e Modais -->
    <div id="message-container" class="fixed bottom-4 right-4 z-50"></div>

    <div id="modal-backdrop"
        class="fixed inset-0 bg-gray-900 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50 hidden">
        <div id="modal-content" class="relative p-6 bg-white w-11/12 md:max-w-lg mx-auto rounded-xl shadow-lg">
            <div class="flex justify-between items-center pb-3 border-b">
                <h3 id="modal-title" class="text-xl font-semibold text-gray-900"></h3>
                <button id="modal-close-btn" class="text-gray-400 hover:text-gray-600 text-2xl leading-none font-semibold">×</button>
            </div>
            <div id="modal-body" class="mt-4 max-h-[70vh] overflow-y-auto"></div>
        </div>
    </div>

    <div id="confirm-modal-backdrop"
        class="fixed inset-0 bg-gray-900 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50 hidden">
        <div class="relative p-6 bg-white w-11/12 md:max-w-sm mx-auto rounded-xl shadow-lg">
            <div class="flex justify-between items-center pb-3 border-b">
                <h3 class="text-xl font-semibold text-gray-900">Confirmação</h3>
                <button id="confirm-modal-close-btn"
                    class="text-gray-400 hover:text-gray-600 text-2xl leading-none font-semibold">×</button>
            </div>
            <div class="mt-4">
                <p id="confirm-modal-message" class="text-gray-700 mb-6"></p>
                <div class="flex justify-end space-x-4">
                    <button id="confirm-modal-cancel-btn"
                        class="px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition">Cancelar</button>
                    <button id="confirm-modal-ok-btn"
                        class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="print-footer" class="hidden">
        PCP FABRECK . JENILTON CRUZ / ORGANOGRAMA
    </div>

    <script>
        // --- Dados Iniciais (Este bloco será atualizado no download) ---
        const initialFactoriesData = {
            "pneus": {
                "id": "pneus",
                "name": "Organograma Pneus",
                "shifts": [{
                    "id": "morning-shift",
                    "name": "TURNO DA MANHÃ",
                    "time": "06:00-15:45 e 07:30-17:15",
                    "responsible": "Jacaré",
                    "functions": {
                        "CALDEIRA": [{
                            "id": "francisco",
                            "name": "FRANCISCO"
                        }],
                        "CORTE CAMELBACK": [{
                            "id": "cristhian",
                            "name": "CRISTHIAN"
                        }],
                        "PINTURA": [{
                            "id": "gabriel",
                            "name": "GABRIEL"
                        }],
                        "CORTE DE LONA": [{
                            "id": "angelica",
                            "name": "ANGELICA"
                        }, {
                            "id": "rebeca",
                            "name": "REBECA"
                        }, {
                            "id": "antonia",
                            "name": "ANTONIA"
                        }],
                        "CONSTRUÇÃO": [{
                            "id": "gustavo",
                            "name": "GUSTAVO"
                        }, {
                            "id": "miriam",
                            "name": "MIRIAM"
                        }, {
                            "id": "vanderleia",
                            "name": "VANDERLEIA"
                        }],
                        "REBARBA E INSPEÇÃO": [{
                            "id": "poliane-m",
                            "name": "POLIANE"
                        }, {
                            "id": "eduarda",
                            "name": "EDUARDA"
                        }],
                        "OPERADOR EMPILHADEIRA": [{
                            "id": "roberto-kobayashi",
                            "name": "ROBERTO KOBAYASHI"
                        }],
                        "VULCANIZAÇÃO": [{
                            "id": "pedro-toneli",
                            "name": "PEDRO TONELI"
                        }],
                        "MANUTENÇÃO": []
                    }
                }, {
                    "id": "afternoon-shift",
                    "name": "TURNO DA TARDE",
                    "time": "13:00-22:45",
                    "responsible": "Brendo",
                    "functions": {
                        "CALDEIRA": [{
                            "id": "tales",
                            "name": "TARLES PEREIRA CABRAL"
                        }],
                        "CORTE CAMELBACK": [{
                            "id": "maicon",
                            "name": "MAICON"
                        }],
                        "PINTURA": [{
                            "id": "eliel",
                            "name": "ELIEL LEITE BARBOSA"
                        }],
                        "CORTE DE LONA": [{
                            "id": "vanessa",
                            "name": "VANESSA"
                        }],
                        "CONSTRUÇÃO": [{
                            "id": "franklin",
                            "name": "FRANKLIN JUNIOR DOS SANTOS ARAUJO"
                        }, {
                            "id": "matheus",
                            "name": "MATHEUS MAURICIO"
                        }, {
                            "id": "yuri",
                            "name": "IURI GOBES"
                        }],
                        "TALÃO": [{
                            "id": "rian",
                            "name": "RYAN MELLO VIANA"
                        }],
                        "REBARBA E INSPEÇÃO": [{
                            "id": "poliane-t",
                            "name": "POLIANE"
                        }],
                        "VULCANIZAÇÃO": [{
                            "id": "kaique",
                            "name": "KAIQUE"
                        }],
                        "MANUTENÇÃO": []
                    }
                }, {
                    "id": "night-shift",
                    "name": "TURNO DA NOITE",
                    "time": "22:00-06:00",
                    "responsible": "Válber",
                    "functions": {
                        "CALDEIRA": [{
                            "id": "thiago-de-mello",
                            "name": "THIAGO DE MELLO"
                        }],
                        "CORTE CAMELBACK": [{
                            "id": "juvenal-neto",
                            "name": "JUVENAL NETO"
                        }],
                        "CONSTRUÇÃO": [{
                            "id": "thiago-marreta",
                            "name": "THIAGO MARRETA"
                        }],
                        "TALÃO": [{
                            "id": "laercio-moreira-junior",
                            "name": "LAÉRCIO MOREIRA JUNIOR"
                        }],
                        "REBARBA E INSPEÇÃO": [{
                            "id": "eliane",
                            "name": "ELIANE"
                        }],
                        "VULCANIZAÇÃO": [{
                            "id": "pedro-henrique-silvestre",
                            "name": "PEDRO HENRIQUE SILVESTRE"
                        }, {
                            "id": "eduardo",
                            "name": "EDUARDO"
                        }],
                        "MANUTENÇÃO": []
                    }
                }]
            },
            "bAro": {
                "id": "bAro",
                "name": "Organograma B-Aro",
                "sectors": {
                    "LIXADEIRAS": [{
                        "id": "emp-1756380093840",
                        "name": "GUILHERME NOVATO"
                    }, {
                        "id": "emp-baro-6",
                        "name": "JOÃO VICTOR DOS SANTOS"
                    }, {
                        "id": "emp-baro-7",
                        "name": "PEDRO AUGUSTO DOS SANTOS"
                    }, {
                        "id": "emp-baro-8",
                        "name": "TIAGO LUCAS DE MELO"
                    }],
                    "POLIMENTO DE FERRO E ALUMÍNIO": [{
                        "id": "emp-baro-13",
                        "name": "DENER MELO"
                    }, {
                        "id": "emp-baro-14",
                        "name": "OSCAR ESCALONA MACHADO"
                    }, {
                        "id": "emp-baro-15",
                        "name": "MARCOS VINICIUS BITENCOURT"
                    }],
                    "LÍDER DE PRODUÇÃO": [{
                        "id": "emp-baro-22",
                        "name": "XANDECO"
                    }, {
                        "id": "emp-baro-24",
                        "name": "LEONARDO"
                    }, {
                        "id": "emp-baro-23",
                        "name": "BOMBADO"
                    }],
                    "FURAÇÃO": [{
                        "id": "emp-baro-16",
                        "name": "WELLINGTON DE SOUZA"
                    }, {
                        "id": "emp-baro-17",
                        "name": "LUCAS GEAN ALVES"
                    }],
                    "FURAÇÃO BROCA": [{
                        "id": "emp-baro-18",
                        "name": "OSMAR ALFONSO GONZALEZ"
                    }],
                    "GUIDOM": [{
                        "id": "emp-baro-19",
                        "name": "ADILSON MORAES DOS SANTOS"
                    }, {
                        "id": "emp-baro-20",
                        "name": "DYONATHAM WILLIAM OLIVEIRA"
                    }],
                    "ESMERIL DESBASTE": [{
                        "id": "emp-baro-12",
                        "name": "MAICON VINÍCIUS ALVES RODRIGUES"
                    }],
                    "ESMERIL EXTERNO": [{
                        "id": "emp-baro-11",
                        "name": "CRISTIAN RAFAEL VALLINA"
                    }],
                    "ESMERIL INTERNO": [{
                        "id": "emp-baro-10",
                        "name": "FRANK DE JESUS SANDOVAL"
                    }],
                    "CALANDRA E SERRA DE PERFIL ALUMÍNIO": [{
                        "id": "emp-baro-21",
                        "name": "LEANDRO DE MELO"
                    }],
                    "CALANDRA E SOLDA": [{
                        "id": "emp-baro-1",
                        "name": "CÉLIO ROBERTO OLIVEIRA TONASSI"
                    }, {
                        "id": "emp-baro-3",
                        "name": "PEDRO HENRIQUE DOS SANTOS"
                    }, {
                        "id": "emp-baro-2",
                        "name": "DOUGLAS WAGNER BARBOZA"
                    }],
                    "CONFORMADORA": [{
                        "id": "emp-baro-9",
                        "name": "GUILHERME HENRIQUE LEITE XAVIER"
                    }],
                    "SERRA": [{
                        "id": "emp-baro-4",
                        "name": "THIAGO APARECIDO DE SOUZA"
                    }, {
                        "id": "emp-baro-5",
                        "name": "THIAGO PEREIRA FRANGILO"
                    }],
                    "ORGANIZAÇÃO E QUALIDADE": [{
                        "id": "emp-baro-25",
                        "name": "LUIS"
                    }]
                }
            },
            "injetoras": {
                "id": "injetoras",
                "name": "Organograma Injetoras de Cubos",
                "sectors": {
                    "MANUTENÇÃO": [{
                        "id": "emp-1756358769265",
                        "name": "ALCIDES"
                    }, {
                        "id": "emp-1756358797025",
                        "name": "ANTONIO"
                    }, {
                        "id": "emp-1756358827193",
                        "name": "HELIO"
                    }, {
                        "id": "emp-1756386157319",
                        "name": "GEOVANI DIAS"
                    }, {
                        "id": "emp-1756423463313",
                        "name": "RANGEL"
                    }],
                    "OPERADOR DE MÁQ / INJETORAS - CUBO": [{
                        "id": "emp-inj-1640995200000",
                        "name": "JULIANO SEVERINO"
                    }, {
                        "id": "emp-inj-1640995200001",
                        "name": "IGOR DE LIMA"
                    }, {
                        "id": "emp-inj-1640995200002",
                        "name": "MARCIO LUIZ"
                    }, {
                        "id": "emp-inj-1640995200003",
                        "name": "KAUAN DA SILVA"
                    }, {
                        "id": "emp-inj-1640995200004",
                        "name": "BRUNO DE OLIVEIRA AR"
                    }, {
                        "id": "emp-inj-1640995200005",
                        "name": "JUCIELIO PEREIRA DE"
                    }, {
                        "id": "emp-inj-1640995200006",
                        "name": "LEONARDO HUDSON FERR"
                    }, {
                        "id": "emp-inj-1640995200008",
                        "name": "ALEX DOS SANTOS"
                    }, {
                        "id": "emp-inj-1640995200009",
                        "name": "RAFAEL AUGUSTO DA SI"
                    }, {
                        "id": "emp-inj-1640995200010",
                        "name": "ADRIANO RODRIGO PALH"
                    }, {
                        "id": "emp-inj-1640995200011",
                        "name": "RENAN DE OLIVEIRA"
                    }, {
                        "id": "emp-inj-1640995200013",
                        "name": "JEAN JESUS DA PAIXAO"
                    }, {
                        "id": "emp-inj-1640995200015",
                        "name": "ANDERSON VALBINO DA"
                    }, {
                        "id": "emp-inj-1640995200014",
                        "name": "SIDNEY CARDOSO"
                    }],
                    "MANUTENCISTA OPERACIONAL": [{
                        "id": "emp-inj-1640995200007",
                        "name": "MATEUS GODOY"
                    }, {
                        "id": "emp-inj-1640995200016",
                        "name": "DANILO"
                    }],
                    "LÍDER DE PRODUÇÃO": [{
                        "id": "emp-inj-1",
                        "name": "JONESLEY ALVÃO"
                    }]
                }
            },
            "injetoraPcs": {
                "id": "injetoraPcs",
                "name": "Organograma Injetora de Pçs",
                "sectors": {
                    "OPERADOR DE MÁQ / INJETORAS - PEÇAS": [{
                        "id": "emp-pcs-1",
                        "name": "AGUINALDO BARONEL"
                    }, {
                        "id": "emp-pcs-2",
                        "name": "CELIO SOARES DE SOUZ"
                    }, {
                        "id": "emp-pcs-3",
                        "name": "CELSO NUNES OLIVEIRA"
                    }, {
                        "id": "emp-pcs-4",
                        "name": "CLESIO SCOTINE"
                    }, {
                        "id": "emp-pcs-6",
                        "name": "DANIEL ROSA GONÇALVE"
                    }, {
                        "id": "emp-pcs-7",
                        "name": "DAVID RAFAEL CALDERA"
                    }, {
                        "id": "emp-pcs-8",
                        "name": "EDUARDO VENTLANDO SO"
                    }, {
                        "id": "emp-pcs-9",
                        "name": "GILBERTO AP PEREIRA"
                    }, {
                        "id": "emp-pcs-13",
                        "name": "JHEMMY"
                    }, {
                        "id": "emp-pcs-14",
                        "name": "JOAO SILVA MENDES"
                    }, {
                        "id": "emp-pcs-15",
                        "name": "JUCELINO BARBOSA DA"
                    }, {
                        "id": "emp-pcs-17",
                        "name": "JULIANO SEVERINO"
                    }, {
                        "id": "emp-pcs-18",
                        "name": "MANOEL"
                    }, {
                        "id": "emp-pcs-19",
                        "name": "MATHEUS FELIPE"
                    }, {
                        "id": "emp-pcs-20",
                        "name": "MATHEUS SEBIN"
                    }, {
                        "id": "emp-pcs-23",
                        "name": "ROBERTO CARLOS PEDRO"
                    }, {
                        "id": "emp-pcs-24",
                        "name": "ROSALINO SANTOS TRIN"
                    }, {
                        "id": "emp-pcs-25",
                        "name": "SIDNEI FERNANDES"
                    }, {
                        "id": "emp-pcs-27",
                        "name": "VANILDO TORRET"
                    }, {
                        "id": "emp-pcs-28",
                        "name": "VITOR STORK"
                    }, {
                        "id": "emp-pcs-29",
                        "name": "WANDERLEI"
                    }],
                    "MANUTENÇÃO": [{
                        "id": "emp-1756358642249",
                        "name": "MATHEUS HENRIQUE"
                    }, {
                        "id": "emp-1756423596888",
                        "name": "MÁRIO "
                    }],
                    "ACABAMENTO": [{
                        "id": "emp-1756385580807",
                        "name": "MATHEUS SARGIN"
                    }],
                    "JATO": [{
                        "id": "emp-1756385616993",
                        "name": "JOSIAS ARAÚJO "
                    }],
                    "LÍDER DE PRODUÇÃO": [{
                        "id": "emp-pcs-lider-maicon",
                        "name": "MAICON"
                    }]
                }
            }
        };
        const initialHiringNeedsData = [{
            "id": "need-1756345798366",
            "factoryId": "pneus",
            "shiftId": "afternoon-shift",
            "sector": "CORTE DE LONA",
            "reasonType": "Desligamento de Funcionário",
            "employeeToReplace": "GISLAINE",
            "departureDate": "2025-08-26",
            "expectedStartDate": "2025-08-26",
            "keyResponsibilities": "CORTE DE LONA",
            "notes": ""
        }, {
            "id": "need-1756345940750",
            "factoryId": "pneus",
            "shiftId": "afternoon-shift",
            "sector": "MANUTENÇÃO",
            "reasonType": "Desligamento de Funcionário",
            "employeeToReplace": "JOSE LUAN",
            "departureDate": "",
            "expectedStartDate": "",
            "keyResponsibilities": "MANUTENÇÃO EM GERAL",
            "notes": ""
        }, {
            "id": "need-1756346054742",
            "factoryId": "pneus",
            "shiftId": "afternoon-shift",
            "sector": "VULCANIZAÇÃO",
            "reasonType": "Desligamento de Funcionário",
            "employeeToReplace": "HIGOR GONÇALVES",
            "departureDate": "",
            "expectedStartDate": "",
            "keyResponsibilities": "VULCANIZAÇÃO E REVEZAMENTO ENTRE SETORES",
            "notes": ""
        }, {
            "id": "need-1756358565793",
            "factoryId": "injetoraPcs",
            "shiftId": null,
            "sector": "OPERADOR DE MÁQ / INJETORAS - PEÇAS",
            "reasonType": "Desligamento de Funcionário",
            "employeeToReplace": "JHEMMY",
            "departureDate": "",
            "expectedStartDate": "",
            "keyResponsibilities": "OPERADOR DE MAQUINA",
            "notes": ""
        }, {
            "id": "need-1756381764053",
            "factoryId": "bAro",
            "shiftId": null,
            "sector": "LIXADEIRAS",
            "reasonType": "Nova Posição",
            "employeeToReplace": "",
            "departureDate": "",
            "expectedStartDate": "2025-09-01",
            "keyResponsibilities": "Lixadeiras",
            "notes": "Ja efetivamos Guilherme, agora só falta a mais um funcionário "
        }, {
            "id": "need-1756384192623",
            "factoryId": "pneus",
            "shiftId": "morning-shift",
            "sector": "TALÃO",
            "reasonType": "Desligamento de Funcionário",
            "employeeToReplace": "luan",
            "departureDate": "",
            "expectedStartDate": "",
            "keyResponsibilities": "",
            "notes": ""
        }, {
            "id": "need-1756384246945",
            "factoryId": "pneus",
            "shiftId": "morning-shift",
            "sector": "VULCANIZAÇÃO",
            "reasonType": "Desligamento de Funcionário",
            "employeeToReplace": "Ronaldo ",
            "departureDate": "",
            "expectedStartDate": "",
            "keyResponsibilities": "Vulcanização ",
            "notes": "Nao está comparecendo trabalho."
        }];
        const initialLogData = [{
            "id": "log-initial-1",
            "type": "SAÍDA",
            "date": "26/08/2025",
            "employeeName": "GISLAINE",
            "context": "Pneus / TURNO DA TARDE / CORTE DE LONA"
        }, {
            "id": "log-initial-2",
            "type": "SAÍDA",
            "date": "28/08/2025",
            "employeeName": "JOSE LUAN",
            "context": "Pneus / TURNO DA TARDE / MANUTENÇÃO"
        }, {
            "id": "log-initial-3",
            "type": "SAÍDA",
            "date": "28/08/2025",
            "employeeName": "HIGOR GONÇALVES",
            "context": "Pneus / TURNO DA TARDE / VULCANIZAÇÃO"
        }, {
            "id": "log-1756358642249",
            "type": "ENTRADA",
            "date": "28/08/2025",
            "employeeName": "ADICIONAR",
            "context": "Organograma Injetora de Pçs / MANUTENÇÃO"
        }, {
            "id": "log-1756358696105",
            "type": "ENTRADA",
            "date": "28/08/2025",
            "employeeName": "ADICIONAR",
            "context": "Organograma Injetoras de Cubos / MANUTENCISTA OPERACIONAL"
        }, {
            "id": "log-1756358738745",
            "type": "SAÍDA",
            "date": "28/08/2025",
            "employeeName": "ADICIONAR",
            "context": "Organograma Injetoras de Cubos / MANUTENCISTA OPERACIONAL"
        }, {
            "id": "log-1756358769265",
            "type": "ENTRADA",
            "date": "28/08/2025",
            "employeeName": "ALCIDES",
            "context": "Organograma Injetoras de Cubos / MANUTENÇÃO"
        }, {
            "id": "log-1756358797025",
            "type": "ENTRADA",
            "date": "28/08/2025",
            "employeeName": "ANTONIO",
            "context": "Organograma Injetoras de Cubos / MANUTENÇÃO"
        }, {
            "id": "log-1756358827193",
            "type": "ENTRADA",
            "date": "28/08/2025",
            "employeeName": "HELIO",
            "context": "Organograma Injetoras de Cubos / LÍDER DE PRODUÇÃO"
        }, {
            "id": "log-1756380093840",
            "type": "ENTRADA",
            "date": "28/08/2025",
            "employeeName": "GUILHERME NOVATO",
            "context": "Organograma B-Aro / LIXADEIRAS"
        }, {
            "id": "log-1756385423236",
            "type": "SAÍDA",
            "date": "28/08/2025",
            "employeeName": "DANILO",
            "context": "Organograma Injetora de Pçs / OPERADOR DE MÁQ / INJETORAS - PEÇAS"
        }, {
            "id": "log-1756385447001",
            "type": "SAÍDA",
            "date": "28/08/2025",
            "employeeName": "GUILHERME MURBACH DA",
            "context": "Organograma Injetora de Pçs / OPERADOR DE MÁQ / INJETORAS - PEÇAS"
        }, {
            "id": "log-1756385453359",
            "type": "SAÍDA",
            "date": "28/08/2025",
            "employeeName": "IGOR DE LIMA",
            "context": "Organograma Injetora de Pçs / OPERADOR DE MÁQ / INJETORAS - PEÇAS"
        }, {
            "id": "log-1756385459949",
            "type": "SAÍDA",
            "date": "28/08/2025",
            "employeeName": "JEAN JESUS DA PAIXAO",
            "context": "Organograma Injetora de Pçs / OPERADOR DE MÁQ / INJETORAS - PEÇAS"
        }, {
            "id": "log-1756385475257",
            "type": "SAÍDA",
            "date": "28/08/2025",
            "employeeName": "JUCIELIO PEREIRA DE",
            "context": "Organograma Injetora de Pçs / OPERADOR DE MÁQ / INJETORAS - PEÇAS"
        }, {
            "id": "log-1756385485283",
            "type": "SAÍDA",
            "date": "28/08/2025",
            "employeeName": "RENAN DE OLIVEIRA",
            "context": "Organograma Injetora de Pçs / OPERADOR DE MÁQ / INJETORAS - PEÇAS"
        }, {
            "id": "log-1756385489341",
            "type": "SAÍDA",
            "date": "28/08/2025",
            "employeeName": "RAFAEL AUGUSTO DA SI",
            "context": "Organograma Injetora de Pçs / OPERADOR DE MÁQ / INJETORAS - PEÇAS"
        }, {
            "id": "log-1756385494720",
            "type": "SAÍDA",
            "date": "28/08/2025",
            "employeeName": "SIDNEY CARDOSO",
            "context": "Organograma Injetora de Pçs / OPERADOR DE MÁQ / INJETORAS - PEÇAS"
        }, {
            "id": "log-1756385580808",
            "type": "ENTRADA",
            "date": "28/08/2025",
            "employeeName": "MATHEUS SARGIN",
            "context": "Organograma Injetora de Pçs / ACABAMENTO"
        }, {
            "id": "log-1756385616993",
            "type": "ENTRADA",
            "date": "28/08/2025",
            "employeeName": "JOSIAS ARAÚJO ",
            "context": "Organograma Injetora de Pçs / JATO"
        }, {
            "id": "log-1756385930123",
            "type": "SAÍDA",
            "date": "28/08/2025",
            "employeeName": "LUCAS DE SOUZA GODOY",
            "context": "Organograma Injetoras de Cubos / OPERADOR DE MÁQ / INJETORAS - CUBO"
        }, {
            "id": "log-1756386157319",
            "type": "ENTRADA",
            "date": "28/08/2025",
            "employeeName": "GEOVANI DIAS",
            "context": "Organograma Injetoras de Cubos / MANUTENÇÃO"
        }, {
            "id": "log-1756423463313",
            "type": "ENTRADA",
            "date": "28/08/2025",
            "employeeName": "RANGEL",
            "context": "Organograma Injetoras de Cubos / MANUTENÇÃO"
        }, {
            "id": "log-1756423596888",
            "type": "ENTRADA",
            "date": "28/08/2025",
            "employeeName": "MÁRIO ",
            "context": "Organograma Injetora de Pçs / MANUTENÇÃO"
        }];

        // Módulo principal da aplicação para organizar o código
        const App = (() => {
            // --- Variáveis de Estado Global ---
            let factories = {};
            let hiringNeeds = [];
            let log = [];
            let selectedShiftId = null;
            let currentFactoryId = 'pneus';
            let currentView = 'organograma';
            let currentOrgSubView = 'overview';
            let isAdminLoggedIn = false;
            const ADMIN_PASSWORD = "FBK123"; // ATENÇÃO: Senha visível no código. Apenas para controle de edição, não para segurança.
            let currentEmployeeForEdit = null;
            const logoBase64 =
                "data:image/jpeg;base64,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";

            // --- Cache de Elementos DOM ---
            const navigationContainer = document.getElementById('navigation-container');
            const mainContentArea = document.getElementById('main-content-area');
            const modalBackdrop = document.getElementById('modal-backdrop');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const messageContainer = document.getElementById('message-container');
            const confirmModalBackdrop = document.getElementById('confirm-modal-backdrop');
            const confirmModalMessage = document.getElementById('confirm-modal-message');
            const confirmModalOkBtn = document.getElementById('confirm-modal-ok-btn');
            const adminLoginSection = document.getElementById('admin-login-section');
            const adminLogoutSection = document.getElementById('admin-logout-section');
            const adminPasswordInput = document.getElementById('admin-password-input');
            const adminLoginBtn = document.getElementById('admin-login-btn');
            const adminLogoutBtn = document.getElementById('admin-logout-btn');
            const logoContainer = document.getElementById('logo-container');

            let confirmCallback = null;

            // --- Funções Utilitárias ---
            const showMessage = (message, type = 'success') => {
                const div = document.createElement('div');
                div.className =
                    `p-3 rounded-md shadow-md mb-2 text-white ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
                div.textContent = message;
                messageContainer.appendChild(div);
                setTimeout(() => div.remove(), 3000);
            };
            const showModal = (title, content) => {
                modalTitle.textContent = title;
                modalBody.innerHTML = content;
                modalBackdrop.classList.remove('hidden');
            };
            const hideModal = () => modalBackdrop.classList.add('hidden');
            const showConfirmModal = (message, callback) => {
                confirmModalMessage.textContent = message;
                confirmCallback = callback;
                confirmModalBackdrop.classList.remove('hidden');
            };
            const hideConfirmModal = () => {
                confirmModalBackdrop.classList.add('hidden');
                confirmCallback = null;
            };

            // --- Funções de Admin ---
            const loginAdmin = () => {
                if (adminPasswordInput.value === ADMIN_PASSWORD) {
                    isAdminLoggedIn = true;
                    showMessage("Login de administrador bem-sucedido!", 'success');
                    adminPasswordInput.value = '';
                    renderApp();
                } else {
                    showMessage("Senha de administrador incorreta.", 'error');
                }
            };
            const logoutAdmin = () => {
                isAdminLoggedIn = false;
                showMessage("Logout de administrador bem-sucedido!", 'success');
                renderApp();
            };

            // --- Carregamento de Dados ---
            const loadData = () => {
                // Clona os dados iniciais para evitar modificar o objeto original diretamente
                factories = JSON.parse(JSON.stringify(initialFactoriesData));
                hiringNeeds = JSON.parse(JSON.stringify(initialHiringNeedsData));
                log = JSON.parse(JSON.stringify(initialLogData));
                renderApp();
            };

            // --- Funções de Ajuda e Transformação de Dados ---
            const getActiveEmployees = (employeeList, factoryId) => {
                if (!employeeList) return [];
                return employeeList.filter(emp =>
                    !hiringNeeds.some(need =>
                        need.reasonType === 'Desligamento de Funcionário' &&
                        need.employeeToReplace &&
                        need.employeeToReplace.toUpperCase() === emp.name.toUpperCase() &&
                        need.factoryId === factoryId
                    )
                );
            };
            const getAllEmployeesFromShift = (shift) => Object.values(shift.functions).flat();
            const getAllEmployeesFromFactory = (factory) => {
                if (factory.shifts) { // Fábrica de Pneus
                    return factory.shifts.flatMap(shift => getAllEmployeesFromShift(shift));
                } else if (factory.sectors) { // Outras fábricas
                    return Object.values(factory.sectors).flat();
                }
                return [];
            };
            const getSectorsForFactory = (factoryId) => {
                if (!factories[factoryId]) return [];
                const factory = factories[factoryId];
                let sectors = new Set();
                if (factory.shifts) { // Pneus
                    factory.shifts.forEach(shift => {
                        Object.keys(shift.functions).forEach(func => sectors.add(func));
                    });
                } else if (factory.sectors) { // Outros
                    Object.keys(factory.sectors).forEach(sector => sectors.add(sector));
                }
                return Array.from(sectors).sort();
            };

            // --- Funções CRUD (Criar, Ler, Atualizar, Deletar) ---
            function handleAddEmployeeClick(factoryId) {
                let modalTitleText = `Adicionar Funcionário a ${factories[factoryId].name}`;
                let modalContent = '';

                if (factoryId === 'pneus') {
                    const preselectedShiftId = (currentView === 'detailedShift') ? selectedShiftId : null;
                    const shiftOptions = factories.pneus.shifts.map(s =>
                        `<option value="${s.id}" ${s.id === preselectedShiftId ? 'selected' : ''}>${s.name}</option>`
                    ).join('');
                    modalContent = `
                        <div class="space-y-4">
                            <div>
                                <label for="add-employee-shift" class="block text-sm font-medium text-gray-700">Turno</label>
                                <select id="add-employee-shift" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                                    ${shiftOptions}
                                </select>
                            </div>
                            <div>
                                <label for="add-employee-name" class="block text-sm font-medium text-gray-700">Nome</label>
                                <input type="text" id="add-employee-name" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3" />
                            </div>
                            <div>
                                <label for="add-employee-sector" class="block text-sm font-medium text-gray-700">Setor/Função</label>
                                <input type="text" id="add-employee-sector" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3" placeholder="Ex: CALDEIRA" />
                            </div>
                            <button id="save-new-employee-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md">Salvar</button>
                        </div>`;

                    showModal(modalTitleText, modalContent);
                    document.getElementById('save-new-employee-btn').addEventListener('click', () => {
                        const selectedShift = document.getElementById('add-employee-shift').value;
                        handleSaveNewEmployee(factoryId, selectedShift);
                    });

                } else {
                    modalContent = `
                        <div class="space-y-4">
                            <div>
                                <label for="add-employee-name" class="block text-sm font-medium text-gray-700">Nome</label>
                                <input type="text" id="add-employee-name" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3" />
                            </div>
                            <div>
                                <label for="add-employee-sector" class="block text-sm font-medium text-gray-700">Setor/Função</label>
                                <input type="text" id="add-employee-sector" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3" placeholder="Ex: NOME DO SETOR" />
                            </div>
                            <button id="save-new-employee-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md">Salvar</button>
                        </div>`;

                    showModal(modalTitleText, modalContent);
                    document.getElementById('save-new-employee-btn').addEventListener('click', () => handleSaveNewEmployee(
                        factoryId, null));
                }
            }


            function handleSaveNewEmployee(factoryId, contextId) {
                const name = document.getElementById('add-employee-name').value.toUpperCase();
                const sector = document.getElementById('add-employee-sector').value.toUpperCase();
                if (!name || !sector) return showMessage("Nome e setor são obrigatórios.", 'error');

                let contextName = '';
                if (factoryId === 'pneus') {
                    const shift = factories.pneus.shifts.find(s => s.id === contextId);
                    if (!shift) return showMessage("Turno não encontrado.", 'error');
                    if (!shift.functions[sector]) shift.functions[sector] = [];
                    shift.functions[sector].push({
                        id: `emp-${Date.now()}`,
                        name
                    });
                    contextName = `Pneus / ${shift.name} / ${sector}`;
                } else if (factories[factoryId]) {
                    if (!factories[factoryId].sectors[sector]) factories[factoryId].sectors[sector] = [];
                    factories[factoryId].sectors[sector].push({
                        id: `emp-${Date.now()}`,
                        name
                    });
                    contextName = `${factories[factoryId].name} / ${sector}`;
                }

                log.push({
                    id: `log-${Date.now()}`,
                    type: 'ENTRADA',
                    date: new Date().toLocaleDateString('pt-BR'),
                    employeeName: name,
                    context: contextName
                });
                hideModal();
                showMessage(
                    "Funcionário adicionado! Clique em 'Salvar e Baixar' para persistir a alteração.",
                    'success');
                renderApp();
            }

            function handleEditEmployeeClick(factoryId, contextId, sectorName, employeeId) {
                let employee;
                if (factoryId === 'pneus') {
                    const shift = factories.pneus.shifts.find(s => s.id === contextId);
                    if (!shift || !shift.functions[sectorName]) return;
                    employee = shift.functions[sectorName].find(e => e.id === employeeId);
                } else {
                    if (!factories[factoryId].sectors[sectorName]) return;
                    employee = factories[factoryId].sectors[sectorName].find(e => e.id === employeeId);
                }
                if (!employee) return;

                currentEmployeeForEdit = {
                    factoryId,
                    contextId,
                    oldSectorName: sectorName,
                    employee
                };

                const modalContent =
                    `<div class="space-y-4"><div><label for="edit-employee-name" class="block text-sm font-medium text-gray-700">Nome</label><input type="text" id="edit-employee-name" value="${employee.name}" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3" /></div><div><label for="edit-employee-sector" class="block text-sm font-medium text-gray-700">Setor/Função</label><input type="text" id="edit-employee-sector" value="${sectorName}" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3" /></div><div class="flex justify-between space-x-4 mt-6"><button id="save-edited-employee-btn" class="flex-grow bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md">Salvar</button><button id="remove-employee-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md">Remover</button></div></div>`;
                showModal(`Editar ${employee.name}`, modalContent);
                document.getElementById('save-edited-employee-btn').addEventListener('click', handleSaveEditedEmployee);
                document.getElementById('remove-employee-btn').addEventListener('click', () => {
                    showConfirmModal(`Tem certeza que deseja remover ${employee.name}? Esta ação é permanente.`, (
                        confirmed) => {
                        if (confirmed) handleRemoveEmployee();
                    });
                });
            }

            function handleSaveEditedEmployee() {
                const {
                    factoryId,
                    contextId,
                    oldSectorName,
                    employee
                } = currentEmployeeForEdit;
                const newName = document.getElementById('edit-employee-name').value.toUpperCase();
                const newSectorName = document.getElementById('edit-employee-sector').value.toUpperCase();
                if (!newName || !newSectorName) return showMessage("Nome e setor são obrigatórios.", 'error');

                if (factoryId === 'pneus') {
                    const shift = factories.pneus.shifts.find(s => s.id === contextId);
                    if (!shift) return;
                    shift.functions[oldSectorName] = shift.functions[oldSectorName].filter(e => e.id !== employee.id);
                    if (shift.functions[oldSectorName].length === 0) delete shift.functions[oldSectorName];
                    if (!shift.functions[newSectorName]) shift.functions[newSectorName] = [];
                    shift.functions[newSectorName].push({
                        id: employee.id,
                        name: newName
                    });
                } else {
                    factories[factoryId].sectors[oldSectorName] = factories[factoryId].sectors[oldSectorName].filter(e => e
                        .id !== employee.id);
                    if (factories[factoryId].sectors[oldSectorName].length === 0) delete factories[factoryId].sectors[
                        oldSectorName];
                    if (!factories[factoryId].sectors[newSectorName]) factories[factoryId].sectors[newSectorName] = [];
                    factories[factoryId].sectors[newSectorName].push({
                        id: employee.id,
                        name: newName
                    });
                }

                hideModal();
                showMessage("Funcionário atualizado! Clique em 'Salvar e Baixar' para persistir a alteração.", 'success');
                renderApp();
            }

            function handleRemoveEmployee() {
                const {
                    factoryId,
                    contextId,
                    oldSectorName,
                    employee
                } = currentEmployeeForEdit;
                let contextName = '';
                if (factoryId === 'pneus') {
                    const shift = factories.pneus.shifts.find(s => s.id === contextId);
                    if (shift && shift.functions[oldSectorName]) {
                        shift.functions[oldSectorName] = shift.functions[oldSectorName].filter(e => e.id !== employee.id);
                        if (shift.functions[oldSectorName].length === 0) delete shift.functions[oldSectorName];
                        contextName = `Pneus / ${shift.name} / ${oldSectorName}`;
                    }
                } else {
                    if (factories[factoryId].sectors[oldSectorName]) {
                        factories[factoryId].sectors[oldSectorName] = factories[factoryId].sectors[oldSectorName].filter(
                            e => e.id !== employee.id);
                        if (factories[factoryId].sectors[oldSectorName].length === 0) delete factories[factoryId].sectors[
                            oldSectorName];
                        contextName = `${factories[factoryId].name} / ${oldSectorName}`;
                    }
                }
                log.push({
                    id: `log-${Date.now()}`,
                    type: 'SAÍDA',
                    date: new Date().toLocaleDateString('pt-BR'),
                    employeeName: employee.name,
                    context: contextName
                });
                hideModal();
                showMessage("Funcionário removido! Clique em 'Salvar e Baixar' para persistir a alteração.", 'success');
                renderApp();
            }

            // --- Função de Download do Ficheiro ---
            function handleDownloadHtml() {
                // Converte os objetos de dados atuais em strings formatadas de JavaScript
                const newFactoriesString = `const initialFactoriesData = ${JSON.stringify(factories, null, 4)};`;
                const newHiringNeedsString = `const initialHiringNeedsData = ${JSON.stringify(hiringNeeds, null, 4)};`;
                const newLogString = `const initialLogData = ${JSON.stringify(log, null, 4)};`;

                // Pega o conteúdo HTML completo da página atual
                let fullHtml = document.documentElement.outerHTML;

                // Substitui os blocos de dados antigos pelos novos, usando expressões regulares
                fullHtml = fullHtml.replace(/const initialFactoriesData = {[\s\S]*?};/, newFactoriesString);
                fullHtml = fullHtml.replace(/const initialHiringNeedsData = \[[\s\S]*?\];/, newHiringNeedsString);
                fullHtml = fullHtml.replace(/const initialLogData = \[[\s\S]*?\];/, newLogString);

                // Cria um "Blob" (Binary Large Object) com o novo conteúdo HTML
                const blob = new Blob([fullHtml], {
                    type: 'text/html'
                });
                // Cria um link temporário para o download
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'organograma-atualizado.html'; // Nome do ficheiro a ser baixado
                document.body.appendChild(a);
                a.click(); // Simula o clique no link para iniciar o download
                document.body.removeChild(a); // Remove o link da página
                URL.revokeObjectURL(a.href); // Libera a memória usada pelo URL do Blob

                showMessage("Ficheiro HTML atualizado foi baixado!", 'success');
            }

            // --- Funções de Necessidades de Contratação ---
            function handleAddHiringNeedClick() {
                const factoryOptions = Object.values(factories).map(f => `<option value="${f.id}">${f.name}</option>`)
                    .join('');
                const modalContent = `
                <div class="space-y-4 text-left">
                     <div>
                        <label class="block text-sm font-medium text-gray-700">Fábrica</label>
                        <select id="hiring-need-factory" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">${factoryOptions}</select>
                    </div>
                    <div id="shift-selector-container" class="hidden">
                        <label class="block text-sm font-medium text-gray-700">Turno</label>
                        <select id="hiring-need-shift" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Setor (Função)</label>
                        <select id="hiring-need-sector" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"><option value="">Selecione uma fábrica</option></select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Motivo da Vaga</label>
                        <select id="hiring-need-reasonType" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3">
                            <option value="">Selecione</option>
                            <option value="Aumento de Produção">Aumento de Produção</option>
                            <option value="Desligamento de Funcionário">Desligamento de Funcionário</option>
                            <option value="Nova Posição">Nova Posição</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>
                    <div id="replacement-fields" class="hidden space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Funcionário a ser Substituído</label>
                            <input type="text" id="hiring-need-employeeToReplace" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Data do Desligamento</label>
                            <input type="date" id="hiring-need-departureDate" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3" />
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Data de Início Prevista</label>
                        <input type="date" id="hiring-need-expectedStartDate" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Principais Responsabilidades</label>
                        <textarea id="hiring-need-keyResponsibilities" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Observações Gerais</label>
                        <textarea id="hiring-need-notes" rows="2" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3"></textarea>
                    </div>
                    <button id="save-new-hiring-need-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md">Salvar Necessidade</button>
                </div>`;
                showModal("Criar Nova Necessidade de Contratação", modalContent);

                const factorySelect = document.getElementById('hiring-need-factory');
                const shiftContainer = document.getElementById('shift-selector-container');
                const shiftSelect = document.getElementById('hiring-need-shift');
                const sectorSelect = document.getElementById('hiring-need-sector');

                factorySelect.addEventListener('change', (e) => {
                    const selectedFactoryId = e.target.value;
                    const selectedFactory = factories[selectedFactoryId];

                    const sectors = getSectorsForFactory(selectedFactoryId);
                    sectorSelect.innerHTML = '<option value="">Selecione</option>' + sectors.map(s =>
                        `<option value="${s}">${s}</option>`).join('');

                    if (selectedFactory.shifts) {
                        shiftContainer.classList.remove('hidden');
                        shiftSelect.innerHTML = '<option value="">Selecione</option>' + selectedFactory
                            .shifts.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
                    } else {
                        shiftContainer.classList.add('hidden');
                        shiftSelect.innerHTML = '';
                    }
                });

                document.getElementById('hiring-need-reasonType').addEventListener('change', (e) => {
                    document.getElementById('replacement-fields').classList.toggle('hidden', e.target
                        .value !== 'Desligamento de Funcionário');
                });
                document.getElementById('save-new-hiring-need-btn').addEventListener('click', handleSaveNewHiringNeed);

                factorySelect.dispatchEvent(new Event('change'));
            }

            function handleSaveNewHiringNeed() {
                const newNeed = {
                    id: `need-${Date.now()}`,
                    factoryId: document.getElementById('hiring-need-factory').value,
                    shiftId: document.getElementById('hiring-need-shift').value || null,
                    sector: document.getElementById('hiring-need-sector').value,
                    reasonType: document.getElementById('hiring-need-reasonType').value,
                    employeeToReplace: document.getElementById('hiring-need-employeeToReplace').value,
                    departureDate: document.getElementById('hiring-need-departureDate').value,
                    expectedStartDate: document.getElementById('hiring-need-expectedStartDate').value,
                    keyResponsibilities: document.getElementById('hiring-need-keyResponsibilities').value,
                    notes: document.getElementById('hiring-need-notes').value,
                };

                if (!newNeed.factoryId || !newNeed.sector || !newNeed.reasonType) {
                    return showMessage("Fábrica, Setor e Motivo são obrigatórios.", 'error');
                }

                hiringNeeds.push(newNeed);
                hideModal();
                showMessage("Necessidade de contratação criada! Salve o ficheiro para manter.", 'success');
                renderApp();
            }

            // --- Funções de Renderização (Desenhar a interface) ---
            function renderNavigation() {
                const adminButtonState = (color) => isAdminLoggedIn ? `bg-${color}-600 hover:bg-${color}-700` :
                    'bg-gray-500 cursor-not-allowed';
                const adminDisabled = !isAdminLoggedIn ? 'disabled' : '';

                const contextButtons =
                    `<li class="pt-4 border-t border-blue-600 mt-4"><button data-factory-id="${currentFactoryId}" class="add-employee-btn w-full text-left py-2 px-4 rounded-md font-bold transition ${adminButtonState('purple')}" ${adminDisabled}>Adicionar Funcionário</button></li>`;

                navigationContainer.innerHTML = `
                <h2 class="text-xl font-semibold mb-4 border-b border-blue-700 pb-2">Fábricas</h2>
                <ul class="space-y-3">
                    <li><button data-factory="pneus" class="factory-btn w-full text-left py-2 px-4 rounded-md transition ${currentFactoryId === 'pneus' ? 'bg-blue-700 font-bold' : 'hover:bg-blue-800'}">Organograma Pneus</button></li>
                    <li><button data-factory="bAro" class="factory-btn w-full text-left py-2 px-4 rounded-md transition ${currentFactoryId === 'bAro' ? 'bg-blue-700 font-bold' : 'hover:bg-blue-800'}">Organograma B-Aro</button></li>
                    <li><button data-factory="injetoras" class="factory-btn w-full text-left py-2 px-4 rounded-md transition ${currentFactoryId === 'injetoras' ? 'bg-blue-700 font-bold' : 'hover:bg-blue-800'}">Organograma Injetoras</button></li>
                    <li><button data-factory="injetoraPcs" class="factory-btn w-full text-left py-2 px-4 rounded-md transition ${currentFactoryId === 'injetoraPcs' ? 'bg-blue-700 font-bold' : 'hover:bg-blue-800'}">Organograma Injetora Pçs</button></li>
                </ul>
                <h2 class="text-xl font-semibold my-4 border-b border-blue-700 pb-2">Ações</h2>
                <ul class="space-y-3">
                    <li><button id="hiring-needs-btn" class="w-full text-left py-2 px-4 rounded-md transition ${currentView === 'hiringNeedsOverview' ? 'bg-orange-500 font-bold' : 'hover:bg-orange-600'}">Contratações</button></li>
                    <li><button id="log-btn" class="w-full text-left py-2 px-4 rounded-md transition ${currentView === 'logView' ? 'bg-indigo-500 font-bold' : 'hover:bg-indigo-600'}">Log de Movimentações</button></li>
                    ${contextButtons}
                </ul>
            `;
                adminLoginSection.classList.toggle('hidden', isAdminLoggedIn);
                adminLogoutSection.classList.toggle('hidden', !isAdminLoggedIn);
                attachNavigationListeners();
            }


            function renderAllShiftsOverview(container) {
                const shifts = factories.pneus.shifts;
                const content = shifts.length > 0 ?
                    `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">${shifts.map(shift => {
                const needsForShift = hiringNeeds.filter(need => need.factoryId === 'pneus' && need.shiftId === shift.id);
                let hiringNeedsHtml = needsForShift.length > 0 ? `<div class="mt-4 pt-3 border-t border-blue-200"><h4 class="font-bold text-red-600 text-sm mb-1">VAGA EM ABERTO:</h4><ul class="list-disc list-inside text-sm text-red-800">${needsForShift.map(need => `<li>${need.sector}</li>`).join('')}</ul></div>` : '';
                
                const activeEmployeeCount = getActiveEmployees(getAllEmployeesFromShift(shift), 'pneus').length;

                return `<div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500"><h3 class="text-xl font-bold text-blue-800 mb-2">${shift.name}</h3><p class="text-gray-700"><span class="font-semibold">Responsável:</span> ${shift.responsible}</p><p class="text-gray-700"><span class="font-semibold">Horário:</span> ${shift.time}</p><p class="text-gray-700 mt-2"><span class="font-semibold">Funcionários:</span> ${activeEmployeeCount}</p>${hiringNeedsHtml}<button data-shift-id="${shift.id}" class="view-details-btn mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md transition">Ver Detalhes</button></div>`
            }).join('')}</div>` :
                    `<p class="text-center text-gray-500 text-lg">Nenhum turno cadastrado.</p>`;
                container.innerHTML =
                    `<div class="printable-area"><div class="flex justify-between items-center mb-4 no-print"><h2 class="text-3xl font-bold text-gray-800">Resumo de Todos os Turnos</h2><button class="print-btn bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-md transition">Imprimir</button></div><div class="print-header hidden"><img src="${logoBase64}" alt="Logo" class="print-logo"><h2 class="print-title">FABRECK PNEUS - RESUMO DE TURNOS</h2></div>${content}</div>`;
                container.querySelector('.print-btn').addEventListener('click', () => window.print());
                container.querySelectorAll('.view-details-btn').forEach(button => button.addEventListener('click', e => {
                    selectedShiftId = e.currentTarget.dataset.shiftId;
                    currentView = 'detailedShift';
                    renderApp();
                }));
            }

            function renderFullOrgChart(container) {
                const shifts = factories.pneus.shifts;
                const orgChartContent = shifts.length > 0 ? `
                <div class="flex flex-col items-center">
                    <div class="w-full flex flex-col lg:flex-row justify-around items-start gap-8 org-chart-columns">
                        ${shifts.map(shift => `
                            <div class="flex flex-col items-center w-full lg:w-1/3 org-chart-column">
                                <div class="bg-blue-600 text-white rounded-lg p-4 shadow-lg text-center w-full max-w-sm mb-4 shift-header">
                                    <h3>${shift.name}</h3>
                                    <p>Responsável: ${shift.responsible}</p>
                                </div>
                                <div class="w-full space-y-4">
                                    ${Object.entries(shift.functions).sort((a, b) => a[0].localeCompare(b[0])).map(([func, employees]) => `
                                        <div class="sector-card">
                                            <h4>${func}</h4>
                                            <div class="space-y-2">
                                                ${employees.map(emp => {
                                                    const isTerminated = hiringNeeds.some(need => need.reasonType === 'Desligamento de Funcionário' && need.employeeToReplace && need.employeeToReplace.toUpperCase() === emp.name.toUpperCase() && need.factoryId === 'pneus' && need.sector === func);
                                                    return `<div class="employee-card bg-gray-50 rounded shadow-sm p-2 text-center text-sm ${isAdminLoggedIn ? 'cursor-pointer' : ''} ${isTerminated ? 'terminated' : ''}"
                                                        data-shift-id="${shift.id}" data-function-name="${func}" data-employee-id="${emp.id}">
                                                        ${emp.name}
                                                    </div>`
                                                }).join('')}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            ` : `<p class="text-center text-gray-500 text-lg">Nenhum turno cadastrado.</p>`;

                container.innerHTML = `
                <div class="printable-area">
                    <div class="flex justify-between items-center mb-4 no-print">
                         <h2 class="text-3xl font-bold text-gray-800">Organograma Estruturado</h2>
                         <button class="print-btn bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-md transition">Imprimir</button>
                    </div>
                    <div class="print-header hidden"><img src="${logoBase64}" alt="Logo" class="print-logo"><h2 class="print-title">FABRECK PNEUS</h2></div>
                    <div class="w-full overflow-x-auto p-4 org-chart-container">${orgChartContent}</div>
                </div>`;

                container.querySelector('.print-btn').addEventListener('click', () => window.print());
                container.querySelectorAll('.employee-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        if (!isAdminLoggedIn) return;
                        const {
                            shiftId,
                            functionName,
                            employeeId
                        } = e.currentTarget.dataset;
                        handleEditEmployeeClick('pneus', shiftId, functionName, employeeId);
                    });
                });
            }

            function renderDetailedShiftView(container) {
                const shift = factories.pneus.shifts.find(s => s.id === selectedShiftId);
                if (!shift) {
                    currentView = 'organograma';
                    renderApp();
                    return;
                }

                const needsForShift = hiringNeeds.filter(need => need.factoryId === 'pneus' && need.shiftId === shift.id);
                let hiringNeedsHtml = needsForShift.length > 0 ?
                    `<div class="mb-8 p-4 bg-red-50 border-l-4 border-red-500 rounded-r-lg"><h4 class="font-bold text-red-700 text-lg mb-2">Vagas em Aberto:</h4><ul class="list-disc list-inside text-red-800">${needsForShift.map(need => `<li><strong>${need.sector}:</strong> ${need.reasonType}</li>`).join('')}</ul></div>` :
                    '';

                const functionsHtml = Object.keys(shift.functions).length > 0 ? `
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${Object.entries(shift.functions).sort((a, b) => a[0].localeCompare(b[0])).map(([func, employees]) => `
                        <div class="sector-card">
                            <h4>${func}</h4>
                            <div class="space-y-2">
                                ${employees.map(emp => {
                                    const isTerminated = hiringNeeds.some(need => need.reasonType === 'Desligamento de Funcionário' && need.employeeToReplace && need.employeeToReplace.toUpperCase() === emp.name.toUpperCase() && need.factoryId === 'pneus' && need.sector === func);
                                    return `<div class="employee-card bg-gray-50 rounded shadow-sm p-3 text-center ${isAdminLoggedIn ? 'cursor-pointer' : ''} ${isTerminated ? 'terminated' : ''}"
                                        data-shift-id="${shift.id}" data-function-name="${func}" data-employee-id="${emp.id}">
                                        ${emp.name}
                                    </div>`
                                }).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            ` : `<p class="text-center text-gray-500 text-lg">Nenhum funcionário neste turno.</p>`;

                container.innerHTML =
                    `<div class="w-full max-w-6xl bg-white rounded-xl shadow-2xl p-6 sm:p-8 lg:p-10 mx-auto printable-area"><div class="flex justify-between items-center mb-4 no-print"><h2 class="text-3xl font-bold text-gray-800">Detalhes do Turno</h2><button class="print-btn bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-md transition">Imprimir</button></div><div class="print-header hidden"><img src="${logoBase64}" alt="Logo" class="print-logo"><h2 class="print-title">FABRECK PNEUS - ${shift.name}</h2></div><div class="bg-blue-100 rounded-lg p-5 mb-8 shadow-md text-center"><h2 class="text-3xl font-bold text-blue-900 mb-2">${shift.name}</h2><p class="text-blue-800 text-lg"><span class="font-semibold">Responsável:</span> ${shift.responsible}</p><p class="text-blue-800 text-lg"><span class="font-semibold">Horário:</span> ${shift.time}</p></div>${hiringNeedsHtml}<h3 class="text-2xl font-bold text-gray-800 mb-6 text-center border-b pb-3">Funcionários por Setor</h3>${functionsHtml}</div>`;

                container.querySelector('.print-btn').addEventListener('click', () => window.print());
                container.querySelectorAll('.employee-card').forEach(card => card.addEventListener('click', e => {
                    if (!isAdminLoggedIn) return;
                    const {
                        shiftId,
                        functionName,
                        employeeId
                    } = e.currentTarget.dataset;
                    handleEditEmployeeClick('pneus', shiftId, functionName, employeeId);
                }));
            }

            function renderFactoryOverview(container, factoryId) {
                const factory = factories[factoryId];
                const activeEmployeesCount = getActiveEmployees(getAllEmployeesFromFactory(factory), factoryId).length;

                const content = Object.keys(factory.sectors).length > 0 ?
                    `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">${Object.entries(factory.sectors).sort((a,b) => a[0].localeCompare(b[0])).map(([sectorName, employees]) => {
                const needsForSector = hiringNeeds.filter(need => need.factoryId === factoryId && need.sector === sectorName);
                let hiringNeedsHtml = needsForSector.length > 0 ? `<div class="mt-4 pt-3 border-t border-blue-200"><h4 class="font-bold text-red-600 text-sm mb-1">VAGA EM ABERTO:</h4><ul class="list-disc list-inside text-sm text-red-800">${needsForSector.map(need => `<li>${need.sector}</li>`).join('')}</ul></div>` : '';
                const activeSectorEmployees = getActiveEmployees(employees, factoryId).length;
                return `<div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500"><h3 class="text-xl font-bold text-blue-800 mb-2">${sectorName}</h3><p class="text-gray-700 mt-2"><span class="font-semibold">Funcionários:</span> ${activeSectorEmployees}</p>${hiringNeedsHtml}</div>`
            }).join('')}</div>` :
                    `<p class="text-center text-gray-500 text-lg">Nenhum setor cadastrado.</p>`;

                container.innerHTML =
                    `<div class="printable-area"><div class="flex justify-between items-center mb-4 no-print"><h2 class="text-3xl font-bold text-gray-800">Resumo de Setores ${factory.name}</h2><button class="print-btn bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-md transition">Imprimir</button></div><div class="print-header hidden"><img src="${logoBase64}" alt="Logo" class="print-logo"><h2 class="print-title">${factory.name.toUpperCase().replace('ORGANOGRAMA', 'FABRECK')} - RESUMO DE SETORES</h2></div><div class="text-center mb-8"><p class="text-xl text-gray-600">Total de Funcionários: ${activeEmployeesCount}</p></div>${content}</div>`;
                container.querySelector('.print-btn').addEventListener('click', () => window.print());
            }

            function renderFactoryFullChart(container, factoryId) {
                const factory = factories[factoryId];
                const activeEmployeesCount = getActiveEmployees(getAllEmployeesFromFactory(factory), factoryId).length;

                const topSectorsOrder = ["LÍDER DE PRODUÇÃO", "ORGANIZAÇÃO E QUALIDADE"];
                const allSectorEntries = Object.entries(factory.sectors);

                const topSectorEntries = allSectorEntries.filter(([sectorName]) => topSectorsOrder.includes(sectorName))
                    .sort((a, b) => topSectorsOrder.indexOf(a[0]) - topSectorsOrder.indexOf(b[0]));
                const otherSectorEntries = allSectorEntries.filter(([sectorName]) => !topSectorsOrder.includes(
                    sectorName)).sort((a, b) => a[0].localeCompare(b[0]));

                const renderSector = (sectorName, employees, isLeader = false) => `
                <div class="sector-card ${isLeader ? 'leader' : ''}">
                    <h4>${sectorName}</h4>
                    <div class="space-y-2">
                        ${employees.map(emp => {
                            const isTerminated = hiringNeeds.some(need => need.reasonType === 'Desligamento de Funcionário' && need.employeeToReplace && need.employeeToReplace.toUpperCase() === emp.name.toUpperCase() && need.factoryId === factoryId && need.sector === sectorName);
                            return `<div class="employee-card bg-gray-50 rounded shadow-sm p-3 text-center ${isAdminLoggedIn ? 'cursor-pointer' : ''} ${isTerminated ? 'terminated' : ''}"
                                data-factory-id="${factoryId}" data-sector-name="${sectorName}" data-employee-id="${emp.id}">
                                ${emp.name}
                            </div>`
                        }).join('')}
                    </div>
                </div>`;

                const topSectorsHtml = topSectorEntries.length > 0 ?
                    `<div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-8">${topSectorEntries.map(([name, emps]) => renderSector(name, emps, true)).join('')}</div><hr class="my-8"/>` :
                    '';
                const otherSectorsHtml = otherSectorEntries.length > 0 ?
                    `<h3 class="text-2xl font-bold text-gray-700 mb-6 text-center">Setores de Produção</h3><div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">${otherSectorEntries.map(([name, emps]) => renderSector(name, emps)).join('')}</div>` :
                    '';

                container.innerHTML = `
                <div class="printable-area">
                     <div class="flex justify-between items-center mb-4 no-print">
                        <h2 class="text-3xl font-bold text-gray-800">Organograma Estruturado</h2>
                         <button class="print-btn bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-md transition">Imprimir</button>
                    </div>
                    <div class="w-full max-w-6xl mx-auto">
                        <div class="text-center mb-8 print-header hidden"><img src="${logoBase64}" alt="Logo" class="print-logo"><h2 class="print-title">${factory.name.toUpperCase().replace('ORGANOGRAMA', 'FABRECK')}</h2></div>
                        <div class="text-center mb-8 no-print"><p class="text-xl text-gray-600">Total de Funcionários: ${activeEmployeesCount}</p></div>
                        ${topSectorsHtml}
                        ${otherSectorsHtml}
                    </div>
                </div>`;

                container.querySelector('.print-btn').addEventListener('click', () => window.print());
                container.querySelectorAll('.employee-card').forEach(card => card.addEventListener('click', e => {
                    if (!isAdminLoggedIn) return;
                    const {
                        factoryId,
                        sectorName,
                        employeeId
                    } = e.currentTarget.dataset;
                    handleEditEmployeeClick(factoryId, null, sectorName, employeeId);
                }));
            }

            function renderHiringNeedsOverview(container) {
                const content = hiringNeeds.length > 0 ? `<div class="space-y-6">${hiringNeeds.map(need => {
                const factory = factories[need.factoryId];
                let contextLine = `<p class="text-sm text-gray-600">Fábrica: ${factory ? factory.name : 'N/A'}</p>`;
                if (need.shiftId && factory && factory.shifts) {
                    const shift = factory.shifts.find(s => s.id === need.shiftId);
                    contextLine += `<p class="text-sm text-gray-600">Turno: ${shift ? shift.name : 'N/A'}</p>`;
                }

                return `<div class="bg-yellow-50 border-l-4 border-yellow-500 rounded-r-lg p-4 shadow-md text-left"><div class="flex justify-between items-start"><div><h3 class="text-xl font-bold text-yellow-800">${need.sector}</h3>${contextLine}</div><div class="text-right"><p class="font-semibold">${need.reasonType}</p><p class="text-sm text-gray-600">Início: ${need.expectedStartDate || 'N/A'}</p></div></div>${need.reasonType === 'Desligamento de Funcionário' ? `<p class="text-sm mt-2"><strong>Substituindo:</strong> ${need.employeeToReplace} (Desligamento em: ${need.departureDate || 'N/A'})</p>` : ''}<div class="mt-4 pt-3 border-t"><p class="font-semibold">Responsabilidades:</p><p class="text-sm text-gray-700 whitespace-pre-wrap">${need.keyResponsibilities || 'Não especificado'}</p></div>${need.notes ? `<div class="mt-2 pt-2 border-t"><p class="font-semibold">Observações:</p><p class="text-sm text-gray-700 whitespace-pre-wrap">${need.notes}</p></div>` : ''}</div>`
            }).join('')}</div>` : `<p class="text-center text-gray-500 text-lg">Nenhuma necessidade de contratação registrada.</p>`;

                container.innerHTML =
                    `<div class="w-full max-w-4xl bg-white rounded-xl shadow-2xl p-6 sm:p-8 lg:p-10 mx-auto"><div class="flex justify-between items-center mb-8"><h2 class="text-3xl font-bold text-gray-800">Necessidades de Contratação</h2><button id="add-hiring-need-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md transition ${!isAdminLoggedIn ? 'hidden' : ''}">Adicionar Nova</button></div>${content}</div>`;

                if (isAdminLoggedIn) {
                    container.querySelector('#add-hiring-need-btn').addEventListener('click', handleAddHiringNeedClick);
                }
            }

            function renderLogView(container) {
                const sortedLog = [...log].sort((a, b) => new Date(b.date.split('/').reverse().join('-')) - new Date(a.date
                    .split('/').reverse().join('-')));
                const content = sortedLog.length > 0 ?
                    `<div class="overflow-x-auto"><table class="min-w-full bg-white rounded-lg shadow"><thead class="bg-gray-200"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Funcionário</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Local</th></tr></thead><tbody class="divide-y divide-gray-200">${sortedLog.map(entry => `<tr><td class="px-6 py-4 whitespace-nowrap">${entry.date}</td><td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${entry.type === 'ENTRADA' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${entry.type}</span></td><td class="px-6 py-4 whitespace-nowrap font-medium">${entry.employeeName}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${entry.context}</td></tr>`).join('')}</tbody></table></div>` :
                    `<p class="text-center text-gray-500 text-lg">Nenhum registro de movimentação encontrado.</p>`;
                container.innerHTML =
                    `<div class="w-full max-w-4xl bg-white rounded-xl shadow-2xl p-6 sm:p-8 lg:p-10 mx-auto"><h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Log de Movimentações de Funcionários</h2>${content}</div>`;
            }

            function renderMainContent() {
                mainContentArea.innerHTML = ''; // Limpa o conteúdo principal antes de renderizar
                if (currentView === 'hiringNeedsOverview') {
                    renderHiringNeedsOverview(mainContentArea);
                } else if (currentView === 'logView') {
                    renderLogView(mainContentArea);
                } else if (currentFactoryId === 'pneus') {
                    if (currentView === 'detailedShift') {
                        renderDetailedShiftView(mainContentArea);
                    } else {
                        mainContentArea.innerHTML =
                            `<div class="w-full max-w-7xl bg-white rounded-xl shadow-2xl p-6 sm:p-8 lg:p-10 mx-auto"><div class="sub-nav-tabs mb-8 no-print"><button data-subview="overview" class="sub-nav-btn ${currentOrgSubView === 'overview' ? 'active' : ''}">Resumo</button><button data-subview="fullchart" class="sub-nav-btn ${currentOrgSubView === 'fullchart' ? 'active' : ''}">Organograma</button></div><div id="organograma-sub-content"></div></div>`;
                        const subContentContainer = document.getElementById('organograma-sub-content');
                        if (currentOrgSubView === 'overview') renderAllShiftsOverview(subContentContainer);
                        else if (currentOrgSubView === 'fullchart') renderFullOrgChart(subContentContainer);
                        mainContentArea.querySelectorAll('.sub-nav-btn').forEach(btn => btn.addEventListener('click', e => {
                            currentOrgSubView = e.currentTarget.dataset.subview;
                            renderApp();
                        }));
                    }
                } else if (factories[currentFactoryId]) {
                    mainContentArea.innerHTML =
                        `<div class="w-full max-w-7xl bg-white rounded-xl shadow-2xl p-6 sm:p-8 lg:p-10 mx-auto"><div class="sub-nav-tabs mb-8 no-print"><button data-subview="overview" class="sub-nav-btn ${currentOrgSubView === 'overview' ? 'active' : ''}">Resumo</button><button data-subview="fullchart" class="sub-nav-btn ${currentOrgSubView === 'fullchart' ? 'active' : ''}">Organograma</button></div><div id="organograma-sub-content"></div></div>`;
                    const subContentContainer = document.getElementById('organograma-sub-content');
                    if (currentOrgSubView === 'overview') renderFactoryOverview(subContentContainer, currentFactoryId);
                    else if (currentOrgSubView === 'fullchart') renderFactoryFullChart(subContentContainer,
                        currentFactoryId);
                    mainContentArea.querySelectorAll('.sub-nav-btn').forEach(btn => btn.addEventListener('click', e => {
                        currentOrgSubView = e.currentTarget.dataset.subview;
                        renderApp();
                    }));
                } else {
                    mainContentArea.innerHTML =
                        `<div class="w-full max-w-xl mx-auto bg-white rounded-xl shadow-2xl p-8 text-center"><p class="text-xl text-gray-600">Selecione uma opção.</p></div>`;
                }
            }

            // --- Função principal de renderização e configuração de eventos ---
            function renderApp() {
                renderNavigation();
                renderMainContent();
            }

            function attachNavigationListeners() {
                document.querySelectorAll('.factory-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        currentFactoryId = e.currentTarget.dataset.factory;
                        currentView = 'organograma';
                        currentOrgSubView = 'overview';
                        selectedShiftId = null;
                        renderApp();
                    });
                });
                document.getElementById('hiring-needs-btn')?.addEventListener('click', () => {
                    currentView = 'hiringNeedsOverview';
                    selectedShiftId = null;
                    renderApp();
                });
                document.getElementById('log-btn')?.addEventListener('click', () => {
                    currentView = 'logView';
                    selectedShiftId = null;
                    renderApp();
                });
                document.querySelectorAll('.add-employee-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => handleAddEmployeeClick(e.currentTarget.dataset.factoryId));
                });
            }


            function init() {
                logoContainer.innerHTML = `<img src="${logoBase64}" alt="Fabreck Logo" class="mx-auto">`;
                // Eventos para modais e botões de admin
                modalCloseBtn.addEventListener('click', hideModal);
                document.getElementById('confirm-modal-close-btn').addEventListener('click', hideConfirmModal);
                document.getElementById('confirm-modal-cancel-btn').addEventListener('click', hideConfirmModal);
                confirmModalOkBtn.addEventListener('click', () => {
                    if (confirmCallback) confirmCallback(true);
                    hideConfirmModal();
                });
                adminLoginBtn.addEventListener('click', loginAdmin);
                adminLogoutBtn.addEventListener('click', logoutAdmin);
                document.getElementById('download-html-btn').addEventListener('click', handleDownloadHtml);

                // Carrega os dados e inicia a aplicação
                loadData();
            }

            // Inicia a aplicação quando o conteúdo da página estiver carregado
            window.addEventListener('DOMContentLoaded', init);
        })();
    </script>
</body>

</html>
